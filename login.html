<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل الدخول</title>
<style>
body { font-family: Tahoma, Arial, sans-serif; background:#f5f7fa; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; }
.login-box { background:white; padding:25px 30px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15); width:320px; }
h2 { margin:0 0 20px; text-align:center; color:#333; }
label { display:block; margin-bottom:5px; font-size:14px; color:#555; }
input { width:100%; padding:10px; margin-bottom:15px; border:1px solid #ccc; border-radius:6px; font-size:14px; }
button { width:100%; padding:10px; background:#0066cc; color:white; border:none; border-radius:6px; font-size:16px; cursor:pointer; }
button:hover { background:#004999; }
.result { margin-top:15px; font-size:14px; text-align:center; color:#333; white-space:pre-wrap; }
</style>
</head>
<body>
<div class="login-box">
<h2>تسجيل الدخول</h2>
<form id="loginForm">
<label>الكود (اسم المستخدم):</label>
<input type="text" id="code" required>
<label>الرقم القومي / ID (كلمة المرور):</label>
<input type="password" id="id" required>
<button type="submit">دخول</button>
</form>
<div class="result" id="result"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycby9AOKyy9JftSkMfJ7VtTkP8PdVwbWge6erD9s_ITjAM_drHUGTPHtOqs16SEL5vUD-/exec";

document.getElementById("loginForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const code = document.getElementById("code").value;
  const id = document.getElementById("id").value;
  const resultBox = document.getElementById("result");

  resultBox.innerText = "⏳ جاري الاتصال بالـ API ...";

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code, id })
    });

    const data = await res.json();
    resultBox.innerText = data.message;

    if(data.status === "success"){
      localStorage.setItem("studentCode", code);
      localStorage.setItem("studentId", id);
      window.location.href = "student.html";
    }

  } catch (err) {
    resultBox.innerText = "⚠️ حدث خطأ في الاتصال: " + err.message;
  }
});
</script>
</body>
</html>

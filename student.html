<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>بيانات الطالب</title>
<style>
body { font-family: Tahoma, Arial, sans-serif; background:#f5f7fa; margin:0; padding:20px; }
.container { max-width:600px; margin:auto; background:white; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
h2 { text-align:center; color:#333; }
label { display:block; margin-top:10px; font-weight:bold; }
input { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:6px; }
button { margin-top:15px; padding:10px; background:#0066cc; color:white; border:none; border-radius:6px; cursor:pointer; }
.result { margin-top:10px; font-size:14px; color:#333; text-align:center; }
</style>
</head>
<body>
<div class="container">
<h2>بياناتك</h2>
<div id="studentData"></div>
<div class="result" id="result"></div>
<button id="logout">تسجيل خروج</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycby9AOKyy9JftSkMfJ7VtTkP8PdVwbWge6erD9s_ITjAM_drHUGTPHtOqs16SEL5vUD-/exec";
const code = localStorage.getItem("studentCode");
const id = localStorage.getItem("studentId");
const studentDiv = document.getElementById("studentData");
const resultBox = document.getElementById("result");

if(!code || !id){
  alert("يجب تسجيل الدخول أولاً!");
  window.location.href = "login.html";
}

async function fetchStudentData(){
  try{
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ code, id })
    });
    const data = await res.json();

    studentDiv.innerHTML = `
      <label>الكود:</label><input type="text" value="${code}" disabled>
      <label>الرقم القومي / ID:</label><input type="text" value="${id}" disabled>
      <label>رقم الموبايل:</label><input type="text" id="mobile" value="${data.mobile || ''}">
      <button onclick="updateMobile()">تحديث رقم الموبايل</button>
    `;
  }catch(err){
    studentDiv.innerText = "⚠️ خطأ في تحميل البيانات: " + err.message;
  }
}

async function updateMobile(){
  const mobile = document.getElementById("mobile").value;
  try{
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type": "application/json" },
      body: JSON.stringify({ code, id, mobile })
    });
    const data = await res.json();
    resultBox.innerText = data.message;
  }catch(err){
    resultBox.innerText = "⚠️ حدث خطأ: " + err.message;
  }
}

document.getElementById("logout").addEventListener("click",()=>{
  localStorage.clear();
  window.location.href = "login.html";
});

fetchStudentData();
</script>
</body>
</html>
